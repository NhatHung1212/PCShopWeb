@model IEnumerable<ShopWeb.Models.CartItem>

@{
    ViewData["Title"] = "Shopping Cart";
}

@section Styles {
    <link rel="stylesheet" href="~/css/cart.css" />
}

<div class="cart-section">
    <div class="cart-container">
        @if (Model.Any())
        {
            <div class="cart-header">
                <h1 class="cart-title">Shopping Cart</h1>
                <p class="cart-subtitle">@Model.Count() item@(Model.Count() > 1 ? "s" : "") in your cart</p>
            </div>

            <div class="cart-layout">
                <!-- Cart Items -->
                <div class="cart-items">
                    <div class="cart-items-header">
                        <h2 class="cart-items-title">Your Items</h2>
                        <span class="cart-items-count">@Model.Count() Products</span>
                    </div>
                    
                    @foreach (var item in Model)
                    {
                        var imagePath = !string.IsNullOrEmpty(item.Product?.ImageUrl) 
                            ? (item.Product.ImageUrl.StartsWith("images/") ? item.Product.ImageUrl : $"images/{item.Product.ImageUrl}")
                            : "images/placeholder.png";
                        
                        <div class="cart-item">
                            <div class="cart-item-image">
                                <img src="~/@imagePath" alt="@item.Product?.Name" />
                            </div>
                            
                            <div class="cart-item-details">
                                <div class="cart-item-name">
                                    <a asp-area="" asp-controller="Product" asp-action="Details" asp-route-id="@item.ProductId">
                                        @item.Product?.Name
                                    </a>
                                </div>
                                <div class="cart-item-price">@item.Product?.Price.ToString("N0")đ</div>
                                
                                <div class="cart-item-actions">
                                    <form asp-area="" asp-action="UpdateQuantity" method="post" class="quantity-control" data-item-id="@item.Id">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@item.Id" />
                                        <button type="button" class="qty-btn qty-decrease" onclick="updateQuantity(@item.Id, @item.Quantity - 1)">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <div class="qty-display">@item.Quantity</div>
                                        <input type="hidden" name="quantity" value="@item.Quantity" />
                                        <button type="button" class="qty-btn qty-increase" onclick="updateQuantity(@item.Id, @item.Quantity + 1)">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="cart-item-remove">
                                <div class="cart-item-subtotal">@((item.Product!.Price * item.Quantity).ToString("N0"))đ</div>
                                <form asp-area="" asp-action="Remove" method="post">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@item.Id" />
                                    <button type="submit" class="btn-remove" onclick="return confirm('Remove this item from cart?')">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    }
                </div>

                <!-- Cart Summary -->
                <div class="cart-summary">
                    <h2 class="summary-title">
                        <i class="fas fa-receipt"></i>
                        Order Summary
                    </h2>
                    
                    <div class="summary-row">
                        <span class="summary-label">Subtotal</span>
                        <span class="summary-value">@(((decimal)ViewBag.Subtotal).ToString("N0"))đ</span>
                    </div>
                    
                    <div class="summary-row">
                        <span class="summary-label">Shipping</span>
                        <span class="summary-value">@(((decimal)ViewBag.Shipping) == 0m ? "Miễn phí" : ((decimal)ViewBag.Shipping).ToString("N0") + "đ")</span>
                    </div>
                    
                    <div class="summary-row summary-total">
                        <span class="summary-label">Total</span>
                        <span class="summary-value">@(((decimal)ViewBag.Total).ToString("N0"))đ</span>
                    </div>
                    
                    <a asp-area="" asp-controller="Order" asp-action="Checkout" class="btn-checkout">
                        <i class="fas fa-lock"></i>
                        Proceed to Checkout
                    </a>
                    
                    <a asp-area="" asp-controller="Product" asp-action="Index" class="btn-continue">
                        <i class="fas fa-arrow-left"></i>
                        Continue Shopping
                    </a>
                </div>
            </div>
        }
        else
        {
            <div class="empty-cart">
                <i class="fas fa-shopping-cart"></i>
                <h3>Your cart is empty</h3>
                <p>Add some products to get started</p>
                <a asp-area="" asp-controller="Product" asp-action="Index" class="btn-shop">
                    <i class="fas fa-shopping-bag"></i>
                    Start Shopping
                </a>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        function updateQuantity(itemId, newQuantity) {
            if (newQuantity < 1) return;
            
            const form = document.querySelector(`form[data-item-id="${itemId}"]`);
            const input = form.querySelector('input[name="quantity"]');
            input.value = newQuantity;
            form.submit();
        }
    </script>
}
