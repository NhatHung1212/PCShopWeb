@model IEnumerable<ShopWeb.Models.CartItem>

@{
    ViewData["Title"] = "Checkout";
}

@section Styles {
    <link rel="stylesheet" href="~/css/checkout.css" />
}

<div class="checkout-section">
    <div class="checkout-layout">
        <!-- Checkout Form -->
        <div class="checkout-form-container">
            <h2 class="checkout-section-title">
                <i class="fas fa-shipping-fast"></i>
                Shipping Information
            </h2>
            
            <form asp-area="" asp-action="PlaceOrder" method="post">
                @Html.AntiForgeryToken()
                
                <div class="form-group">
                    <label class="form-label">
                        Full Name <span class="required">*</span>
                    </label>
                    <input type="text" class="form-input" name="fullName" value="@ViewBag.User?.FullName" required placeholder="Enter your full name" />
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        Phone Number <span class="required">*</span>
                    </label>
                    <input type="tel" class="form-input" name="phone" value="@ViewBag.User?.PhoneNumber" required placeholder="Enter your phone number" />
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        Shipping Address <span class="required">*</span>
                    </label>
                    <textarea class="form-input" id="shippingAddress" name="shippingAddress" rows="4" required placeholder="Enter your complete shipping address">@ViewBag.User?.Address</textarea>
                    <p class="form-note">Please provide your complete address including street, city, and postal code</p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Order Notes (Optional)</label>
                    <textarea class="form-input" name="orderNotes" rows="3" placeholder="Add any special delivery instructions..."></textarea>
                </div>
                
                <button type="submit" class="btn-place-order">
                    <i class="fas fa-check-circle"></i>
                    Place Order
                </button>
                
                <a asp-area="" asp-controller="Cart" asp-action="Index" class="btn-back-cart">
                    <i class="fas fa-arrow-left"></i>
                    Back to Cart
                </a>
            </form>
        </div>

        <!-- Order Summary -->
        <div class="checkout-summary-container">
            <h2 class="checkout-section-title">
                <i class="fas fa-receipt"></i>
                Order Summary
            </h2>
            
            <div class="order-items">
                @foreach (var item in Model)
                {
                    var imagePath = !string.IsNullOrEmpty(item.Product?.ImageUrl) 
                        ? (item.Product.ImageUrl.StartsWith("images/") ? item.Product.ImageUrl : $"images/{item.Product.ImageUrl}")
                        : "images/placeholder.png";
                    
                    <div class="order-item">
                        <div class="order-item-image">
                            <img src="~/@imagePath" alt="@item.Product?.Name" />
                        </div>
                        <div class="order-item-details">
                            <div class="order-item-name">@item.Product?.Name</div>
                            <div class="order-item-qty">Qty: @item.Quantity</div>
                        </div>
                        <div class="order-item-price">@((item.Product!.Price * item.Quantity).ToString("N0"))đ</div>
                    </div>
                }
            </div>
            
            <div class="summary-divider"></div>
            
            <div class="summary-row">
                <span class="summary-label">Subtotal</span>
                <span class="summary-value">@(((decimal)ViewBag.Subtotal).ToString("N0"))đ</span>
            </div>
            
            <div class="summary-row">
                <span class="summary-label">Shipping</span>
                <span class="summary-value">@(((decimal)ViewBag.Shipping) == 0m ? "Miễn phí" : ((decimal)ViewBag.Shipping).ToString("N0") + "đ")</span>
            </div>
            
            <div class="summary-divider"></div>
            
            <div class="summary-row summary-total">
                <span class="summary-label">Total</span>
                <span class="summary-value">@(((decimal)ViewBag.Total).ToString("N0"))đ</span>
            </div>
        </div>
    </div>
</div>
